from flask import Flask, request, jsonify
from flask_cors import CORS
from gtts import gTTS
from deep_translator import GoogleTranslator
import os
import uuid

app = Flask(__name__)
CORS(app)

# Create static folder if not exist
if not os.path.exists("static"):
    os.makedirs("static")

@app.route("/translate", methods=["POST"])
def translate():
    data = request.get_json()
    text = data.get("text")
    tld = data.get("tld", "com")  # Default: US English

    if not text:
        return jsonify({"error": "No text provided"}), 400

    try:
        # Step 1: Translate to Bengali (or change the target as needed)
        translated = GoogleTranslator(source='auto', target='bn').translate(text)

        # Step 2: Generate speech audio (gTTS supports only English accents for now)
        tts = gTTS(text, lang='en', tld=tld)

        # Step 3: Save audio to static folder
        filename = f"{uuid.uuid4()}.mp3"
        filepath = os.path.join("static", filename)
        tts.save(filepath)

        return jsonify({
            "translation": translated,
            "audio_url": f"/static/{filename}"
        })

    except Exception as e:
        print("Error:", e)
        return jsonify({"error": "Translation or TTS failed"}), 500

if __name__ == "__main__":
    app.run(debug=True)